{% extends 'base.html' %}

{% block title %}Settings{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-12 col-lg-3 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0"><i class="bi bi-gear me-2"></i>Settings</h6>
                </div>
                <div class="list-group list-group-flush">
                    <a href="#account" class="list-group-item list-group-item-action settings-nav active" data-section="account">
                        <i class="bi bi-person me-2"></i>Account Information
                    </a>
                    <a href="#profile" class="list-group-item list-group-item-action settings-nav" data-section="profile">
                        <i class="bi bi-person-badge me-2"></i>Profile Information
                    </a>
                    <a href="#academic" class="list-group-item list-group-item-action settings-nav" data-section="academic">
                        <i class="bi bi-mortarboard me-2"></i>Academic Information
                    </a>
                    <a href="#password" class="list-group-item list-group-item-action settings-nav" data-section="password">
                        <i class="bi bi-shield-lock me-2"></i>Password & Security
                    </a>
                    <a href="#danger" class="list-group-item list-group-item-action settings-nav text-danger" data-section="danger">
                        <i class="bi bi-exclamation-triangle me-2"></i>Danger Zone
                    </a>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-9">
            <div class="settings-section" id="account-section">
                <div class="card">
                    <div class="card-header bg-white d-flex align-items-center justify-content-between">
                        <h5 class="mb-0"><i class="bi bi-person me-2"></i>Account Information</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{% url 'user_settings' %}">
                            {% csrf_token %}
                            <input type="hidden" name="section" value="account">
                            
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <label class="form-label">First Name</label>
                                    <input type="text" name="first_name" class="form-control" value="{{ request.user.first_name }}" placeholder="Enter your first name">
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" name="last_name" class="form-control" value="{{ request.user.last_name }}" placeholder="Enter your last name">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Email Address</label>
                                    <input type="email" name="email" class="form-control" value="{{ request.user.email }}" placeholder="you@example.com" readonly>
                                </div>
                            </div>

                            <hr>
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save me-1"></i>Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="settings-section d-none" id="profile-section">
                <div class="card">
                    <div class="card-header bg-white d-flex align-items-center justify-content-between">
                        <h5 class="mb-0"><i class="bi bi-person-badge me-2"></i>Profile Information</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{% url 'user_settings' %}">
                            {% csrf_token %}
                            <input type="hidden" name="section" value="profile">
                            
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" name="full_name" class="form-control" value="{% if profile %}{{ profile.full_name }}{% endif %}" placeholder="Enter your full name" required>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Phone Number</label>
                                    <input type="text" name="phone_number" class="form-control" value="{% if profile %}{{ profile.phone_number }}{% endif %}" placeholder="Enter your phone number">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Bio</label>
                                    <textarea name="bio" rows="4" class="form-control" placeholder="Tell us something about you...">{% if profile %}{{ profile.bio }}{% endif %}</textarea>
                                </div>
                            </div>

                            <hr>
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save me-1"></i>Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="settings-section d-none" id="academic-section">
                <div class="card">
                    <div class="card-header bg-white d-flex align-items-center justify-content-between">
                        <h5 class="mb-0"><i class="bi bi-mortarboard me-2"></i>Academic Information</h5>
                    </div>
                    <div class="card-body">
                        {% if is_student %}
                        <form method="POST" action="{% url 'user_settings' %}">
                            {% csrf_token %}
                            <input type="hidden" name="section" value="academic">
                            
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Student ID</label>
                                    <input type="text" name="student_id" class="form-control" value="{% if profile %}{{ profile.student_id }}{% endif %}" placeholder="Enter your student ID" required>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Course</label>
                                    <input type="text" name="course" class="form-control" value="{% if profile %}{{ profile.course }}{% endif %}" placeholder="Enter your course" readonly>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Year Level</label>
                                    <input type="text" name="year_level" class="form-control" value="{% if profile %}{{ profile.year_level }}{% endif %}" placeholder="e.g., 1st Year, 2nd Year" required>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Section</label>
                                    <input type="text" name="section" class="form-control" value="{% if profile %}{{ profile.section }}{% endif %}" placeholder="Enter your section" required>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Academic Interest</label>
                                    <input type="text" name="academic_interest" class="form-control" value="{% if profile %}{{ profile.academic_interest }}{% endif %}" placeholder="What subjects or areas interest you most?">
                                </div>
                            </div>

                            <hr>
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save me-1"></i>Save Changes
                                </button>
                            </div>
                        </form>
                        {% elif is_teacher %}
                        <form method="POST" action="{% url 'user_settings' %}">
                            {% csrf_token %}
                            <input type="hidden" name="section" value="academic">
                            
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Department</label>
                                    <input type="text" name="department" class="form-control" value="{% if profile %}{{ profile.department }}{% endif %}" placeholder="Enter your department" required>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label">Years of Experience</label>
                                    <input type="text" name="years_of_exp" class="form-control" value="{% if profile %}{{ profile.years_of_exp }}{% endif %}" placeholder="e.g., 5 years" required>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Highest Qualification</label>
                                    <input type="text" name="highest_qualification" class="form-control" value="{% if profile %}{{ profile.highest_qualification }}{% endif %}" placeholder="e.g., Master's Degree, PhD" required>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Specialization</label>
                                    <input type="text" name="specialization" class="form-control" value="{% if profile %}{{ profile.specialization }}{% endif %}" placeholder="What subjects do you specialize in?">
                                </div>
                            </div>

                            <hr>
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save me-1"></i>Save Changes
                                </button>
                            </div>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="settings-section d-none" id="password-section">
                <div class="card">
                    <div class="card-header bg-white d-flex align-items-center justify-content-between">
                        <h5 class="mb-0"><i class="bi bi-shield-lock me-2"></i>Password & Security</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{% url 'user_settings' %}">
                            {% csrf_token %}
                            <input type="hidden" name="section" value="password">

                            {% if request.user.has_usable_password %}
                                <div class="row g-3">
                                    <div class="col-12">
                                        <label class="form-label">Current Password</label>
                                        <input type="password" name="current_password" class="form-control" placeholder="Enter your current password" required>
                                        <small class="text-muted">Enter your current password to change it.</small>
                                    </div>
                                    <div class="col-12 col-md-6">
                                        <label class="form-label">New Password</label>
                                        <input type="password" name="new_password" class="form-control" placeholder="Enter new password" required>
                                    </div>
                                    <div class="col-12 col-md-6">
                                        <label class="form-label">Confirm New Password</label>
                                        <input type="password" name="confirm_password" class="form-control" placeholder="Confirm new password" required>
                                    </div>
                                </div>
                            {% else %}
                                <div class="row g-3">
                                    <div class="col-12 col-md-6">
                                        <label class="form-label">New Password</label>
                                        <input type="password" name="new_password" class="form-control" placeholder="Set a new password" required>
                                    </div>
                                    <div class="col-12 col-md-6">
                                        <label class="form-label">Confirm New Password</label>
                                        <input type="password" name="confirm_password" class="form-control" placeholder="Confirm new password" required>
                                    </div>
                                </div>
                                <small class="text-muted">You don’t have a password yet. Set one now to log in directly next time.</small>
                            {% endif %}

                            <div class="alert alert-info mt-3">
                                <i class="bi bi-info-circle me-2"></i>
                                <strong>Password Requirements:</strong> Your password must be at least 8 characters long.
                            </div>

                            <hr>
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-shield-check me-1"></i>Update Password
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="settings-section d-none" id="danger-section">
                <div class="card border-danger">
                    <div class="card-header bg-danger text-white d-flex align-items-center justify-content-between">
                        <h5 class="mb-0"><i class="bi bi-exclamation-triangle me-2"></i>Danger Zone</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <strong>Warning:</strong> These actions are irreversible. Please proceed with caution.
                        </div>
                        
                        <div class="d-flex align-items-center justify-content-between p-3 border rounded">
                            <div>
                                <h6 class="mb-1">Delete Account</h6>
                                <p class="text-muted mb-0">Permanently delete your account and all associated data.</p>
                            </div>
                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                                <i class="bi bi-trash me-1"></i>Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block modals %}
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteAccountModalLabel">
                    <i class="bi bi-exclamation-triangle me-2"></i>Delete Account
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>This action cannot be undone!</strong>
                </div>
                <p>Are you sure you want to delete your account? This will permanently remove:</p>
                <ul>
                    <li>Your profile information</li>
                    <li>All your academic records</li>
                    <li>Your room memberships and submissions</li>
                    <li>All other account data</li>
                </ul>
                <p class="text-danger"><strong>This action is irreversible.</strong></p>
                
                <form method="POST" action="{% url 'delete_account' %}" id="deleteAccountForm">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="deletePassword" class="form-label">Enter your password to confirm:</label>
                        <input type="password" class="form-control" id="deletePassword" name="password" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="deleteAccountForm" class="btn btn-danger">
                    <i class="bi bi-trash me-1"></i>Delete Account
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const navItems = document.querySelectorAll('.settings-nav');
    const sections = document.querySelectorAll('.settings-section');
    
    navItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            
            navItems.forEach(nav => nav.classList.remove('active'));
            
            this.classList.add('active');
            
            sections.forEach(section => section.classList.add('d-none'));
            
            const targetSection = this.getAttribute('data-section') + '-section';
            document.getElementById(targetSection).classList.remove('d-none');
        });
    });
    
    const hash = window.location.hash.substring(1);
    if (hash) {
        const targetNav = document.querySelector(`[data-section="${hash}"]`);
        if (targetNav) {
            targetNav.click();
        }
    }
});
</script>
{% endblock %}


